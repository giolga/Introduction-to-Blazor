@page "/shoppinglist"
@using FirstBlazor.Data

<PageTitle>@title </PageTitle>
<h3>ShoppingList</h3>

@* <input placeholder="Grocery Name" @bind="groceryName" />
<input placeholder="Grocery Price" @bind="groceryPrice" />
<button @onclick="AddGrocery">Add Grocery</button> *@

<EditForm Model="@grocery" OnSubmit="AddGrocery">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <p>
        <label>
            Name:
            <InputText @bind-Value="grocery.Name"></InputText>
        </label>
    </p>

    <p>
        <label>
            Price:
            <InputNumber @bind-Value="grocery.Price"></InputNumber>
        </label>
    </p>

    <button type="submit"> Add grocery</button>
</EditForm>

<table class="table table-sm">
    <tr>
        <th>Name</th>
        <th>Price</th>
        <th></th>
    </tr>

    @foreach (var grocery in groceries)
    {
        <Item GroceryItem="@grocery" OnGroceryPriceIncreased="OnGroceryPriceIncreased" />
    }

</table>

<h1>Total (@sum)</h1> @*One way data binding!*@

@code {
    private float sum = 0f;
    private string title = "Our groceries";
    private string groceryName = string.Empty;
    private float groceryPrice = 0f;

    private Grocery grocery = new();

    private List<Grocery> groceries = new();
    private void AddGrocery()
    {
        groceries.Add(grocery);
        grocery = new();
        UpdateTotalAmount();
    }

    public void UpdateTotalAmount()
    {
        sum = groceries.Sum(x => x.Price);
    }

    public void OnGroceryPriceIncreased()
    {
        UpdateTotalAmount();
    }
}
